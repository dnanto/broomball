```{r, setup}
library(tidyverse)
library(openxlsx)
source("season.R")
```

```{r read}
con <- DBI::dbConnect(RSQLite::SQLite(), "stats.db")
df.point <- DBI::dbReadTable(con, "point")
df.lstat <- DBI::dbReadTable(con, "lstat")
df.penalty <- DBI::dbReadTable(con, "penalty")
DBI::dbDisconnect(con)
```

```{r type-1}
v1 <-
  group_by(df.lstat, player) %>%
  summarise(
    EVG = sum(G), EVA = sum(A), 
    PPG = sum(PPG), PPA = sum(PPA), 
    SHG = sum(SHG), SHA = sum(SHA), 
    PIM = sum(PIM)
  ) %>%
  mutate(
    P = EVG + EVA + PPG + PPA + SHG + SHA,
    G = EVG + PPG + SHG,
    A = EVA + PPA + SHA
  )

v1
```

```{r type-2}
v2 <- overall.2(df.point, df.penalty)
v2
```

```{r overall}
bind_rows(v1, v2) %>% 
  select(player, P, G, A, EVG, EVA, PPG, PPA, SHG, SHA, PIM) %>%
  group_by(player) %>%
  summarise_all(sum) %>%
  arrange(desc(P), desc(EVG), desc(PPG), desc(SHG), desc(EVA), desc(SHA), desc(PPA), PIM)
```
