---
title: "Capitol Broomball"
author: "Stats Department"
date: "`r format(Sys.time(), '%B %d, %Y')`"
params:
  db: "stats.db"
  year: 2020
  season: 24
---

```{r, setup, include=F}
library(tidyverse)
source("season.R")
knitr::opts_chunk$set(echo = F)
```

```{r query}
con <- DBI::dbConnect(RSQLite::SQLite(), "stats.db")

res <- 
  DBI::dbSendQuery(
    con, "SELECT * FROM point as p JOIN match as m ON p.match = m.id WHERE year = ? AND season = ?;", 
    param = list(params$year, params$season)
  )
df.point <- DBI::dbFetch(res) %>% select(week, game, 3:13)
DBI::dbClearResult(res)

res <- 
  DBI::dbSendQuery(
    con, "SELECT * FROM penalty as p JOIN match as m ON p.match = m.id WHERE year = ? AND season = ?;", 
    param = list(params$year, params$season)
  )
df.penalty <- DBI::dbFetch(res) %>% select(week, game, 3:11)
DBI::dbClearResult(res)

DBI::dbDisconnect(con)
```

### Stat

```{r, ranking}
overall.2(df.point, df.penalty) %>% datatableize()
```

### Assist

```{r, assist}
datatableize(df.point)
```

### Penalty

```{r, penalty}
datatableize(df.penalty)
```

